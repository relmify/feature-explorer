# Feature Explorer Domain Model

## C4 Models

### Context

Source: [C1_FeatureExplorerContext.puml](C1_FeatureExplorerContext.puml)

![Feature_Explorer_System_Context_Diagram](https://www.plantuml.com/plantuml/svg/0/XLJRRjim37ttLt3TmreWjZ6i6ue-DMtIRa1lMD8EUmfKcxQrof8XKKdJhnzbnxbiAHe_nEBby1oAz9aZOSdN2YvHaBSu6xyqobYqiydI4TQp2wC9NsWsagAqeeu-I9qfdoDKH8qxJLCh5aafgV9Ftg7DGhYc93DrAd8hXPuht_ZquZY-LqBJmyrrgWIX8pRru4d33A9FC8J2AxM4HIK9uKbapwKrNkUG6UO45dMEre5mG5PermYs44WDayShC9uQJupouAGkGMWmHR62wlAbPaKYJpXcWdYwLb0Ow-ka2VIOHwAHqfClNx-bRMwyeU5YBXXtB32FjpZ4KiTkNaRkMMgsY1hErraNRUsFb-FmR4LC9Icyv0PCv2l2vvEzBbegReHH-JxlhQWH1FTOxVEkwXwtluWrRsAKP8tB1i5OgamKNGz_tprCPxz-JB_FhiTNuzlHuL4KKK3gvmBwkO1kBc1rTT3FHNJFLsFqOT753pqZsm4SzFcTuO0jzzRaFYEuMsZaYFvu8xGeW-7SymMYSp3KGd6nJSW8dIpRf2aFKFWVuHoLQT0cIN9m57NSUWuzvIqMlIdmU9JE2mKJyhaqh8TdcWMXTjBeDHRl0ntENV26b4aRzqQsCzvcOTW2KYw9vUx052umaTpKpXXWfXL24KokQojLWY0iaU1fXIKZmafD6-OOCVg9wjys_wzuBd7Xrhcy7E7I1_37rmslZ-ajm2DU3tXRye1FORrwJxY6akljARTkI6OnBFC0V9DtBm4fHuLys6NUUQJ5Z1iZ-TpZRnVO25YNQAoPotmB3Vj931Atc8UjvyzEpPQWS9Vv1hYzXOMWh7gNOJYpG8Rh_5AlG7jokrZlO8ItXPNqPcWB7vtnzuK_Gty1 "Feature_Explorer_System_Context_Diagram")

### Container

Source [C2_FeatureExplorerContainer.puml](C2_FeatureExplorerContainer.puml)

![Feature_Explorer_Container_Diagram](https://www.plantuml.com/plantuml/svg/0/XLJRRXen47tVhvZIXmO95bLDgoXF8K3IIhcfa5HzGivwM9nuxPKzXj2g_zxnBiibeWtxW7tcScREs3xp91o5GiC52WeEfwENKbk7RZgmXeGol1egaJjH9E-KoNIG27EYqf_sUauiqrpHF3m6ZoxZ03IKPhRe2UcKC0iToj0R77Vlj31qVttLquBG4qFRz6d9zCa7wCCiQBs2vLmHmgF8ddDdWv6GMIu871g9peFmG4uONmf629I1ySCbs41b8CvoxvN9GHYmizawLHslZ2SKCcMVCUBffeUPTQ58orWWrv4QfDx9fyzVUbLiTrk6xp9Xjwu2PNUdXguoNR_84_-i32EYWFDDrA3YVdynYj-EnqIHnWkMOAn-8NmyEMYYbMOXh9Q7h3UYG12iiZvaNVCULxyakUh_lBsVJ7zyctoTNeqkHpV3etQIKFHk1W_Du64p6LWF7fBaZgMtvcXM-_O3pQthGAk9hO4M8tVEof0Ht2uvGGUQxRKm8e_0UU01eVVGDqAlF6rTXkXLNWLD-8Z4_o4kKDkIZqYQjjh9cDsnu0DAHmi_i1APxc4CSHMP7vGFGiEOWbIsGi7RuB9u07YDKX6Nk9TcvcCFYaMemPXcCaUOHSXN4D1S46Ir91vMd17MAbHkdZCsAS_Zn8LRDJ8rYku8rK2jDlnEO2lrwn2k3erNrXo8XOsnjLLW1smdVvBaE-hNq_eFnKBXqc_wuikakQWEF8MYvEjc6mJuIXGTlbqozaxnEZQMEDQSgG_mReQLEOpNlmEXbFKYPfAeaJVxgjOMvJ3ZeIdUD_bt2Gvqik4gdLqekPCM6_LYhpijnEU2Nwo2aTXgb7JXgnCZIhNVq06-wWGj1MNpDpk8UnQ0MMgxgiPdc2bzyckYflpzj6-aYwkbK_HFrzTCoHc_OlpO_GK0 "Feature_Explorer_Container_Diagram")

### Component

Source [C3_FeatureExplorerComponent.puml](C3_FeatureExplorerComponent.puml)

![Feature_Explorer_Component_Diagram](https://www.plantuml.com/plantuml/svg/0/ZLPBR-D63BxhLx3feGaGsoYwBHPxsbt7JWkass3jPD6JCPPeUP3HZ30FUzsY_xtaw679Lk0uXsX8YlpuyJ7wwBomFXGAvYXyiBYQVI-LiMXNKrEKHgFsgpifSYkAv0UfKnKoXAttfVimcLYn7-VIRyCwEBIfqPxCnwaf9YApKkYT2cMOJD-D7fNG_kdFXuaI7fqdqT7zkAJmoK_m2JP1gGFijz8Zh4NwabiJT0Qf8K1WKMTe7GW7tWhjIa4I3rB3ulaUJF1byEJboKcTWz1WDflQLVM-rCwZoCPaiq3yqEQmCJOKuv814ewnHZzv_ykllqtYkwCZ33UYWACA1MQZ3eQHr2EtonFt8ZL9H06VsxUcCVQFynd_TIoMqYkS4s4B-G_2p-y7LVwWY0YZiY7j5r4W269P3MdhkE_YBqaUFltzrzDozUsFvU-hXzdzxClTzKsIUBPk2WzDuQ6j3DI5XsHn8F8AwWr_lNDJa-4jN3qlW9-k-56w81GiVCYaYL8WgoAaJ3uTC9FUsAkRhf-vL5WToG4Ve3gnl-KMOSCY5qNWjy83jvUWAjA9j3Lejd9zn_aMBH52RkwhfyeL4KGzojwd8Gt5cXBDp_NWKYjBJnwJhwZQP7jWdrmCoVesLi_WA_MPgw31nfg2lKqhz3HNdxalX3rSpsUS-GdxLpVmRmB76bpN1er-WNOdKnnu4seLf_XepKvc7BusmiPe4tJgfT52INyWOBrGXFYRy2abrTIaFhBFwh6YVs_i2tK_rNT3xSdcr6skn5Hk96Pjr4nQJAdoXrkoi_sYqOncHmD8jqBdaTU1v1dAOwnF9--8xx6jQdno0p4iae3Q9XQuWqruCHpjcRWXhUa6QsMnWRQOlWmwZ6cMrgmL5ltekyh11G04-a4wJokiKsVEivOErdWjd4nflr7iGd1jGQnf7mxGBCy9bigZFOrNYGQ3SVN5MdBtW3SSWupFioDKf1UvkmMqrbZwpq3smcho_4gPbnRnZbYfWtNvPnMm3Xfb3rNadYOv5e1801Ua5rI5M91CEjhl1qufsjIRY-uHShgJk1-6Gu92w3wELjOBdrPILoygkdtMjFc4Kam8BO0cOep3U-FLX5-TTbuwJ7YE_jXfN8msYKWmMPHecOIk8awyEur-5gG__ysynydb7kmFR2Yvu0u2NxYNNGyCyZtwLuQesfcNmPxDIiDIJTG0RA9PUzvIzZ8VxLLtx7xcD69ahuQeZWF7CTy2-7JK6hWPagQWsw4A8FdEsqadgpbxAxdTlHMvVMwcSdw9tKwhN-n0_8vfY9zLLTE_kQcxytJgxDYi7RUDtsvRjZM97cA1zvLkCB5kmnq_39gx8Yx8FNt07byRwAhUtHw9xUxQEkf_2Vq-qjSXVKJ-3m00 "Feature_Explorer_Component_Diagram")

## Foundational Architecture

The architecture is modelled using Domain Driven Development techniques, and uses an event-driven architecture with event-carried state transfer. Components (bounded contexts) communicate with each other by publishing and subscribing to events. Events carry the information that subscribers need to be able to continue the overall workflow.

## Core Domain Bounded Contexts

### Feature Explorer Extension

The entry point to the feature explorer extension. It initializes and tears down the extension on request, acts as the composition root for the extension, and provides the tree view and command handlers for the extension.

### Feature Explorer Tree Data Provider

Acts as the interface between the Visual Studio Code Tree View and the Feature Explorer Service. It translates between the event collaboration style of the extension and the VS Code extension model.

```TypeScript
class FeatureExplorerTreeDataProvider extends TreeDataProvider {

}

```

### Feature Explorer Service

Keeps track of the tree of directories, files, and validated features.

```TypeScript

// Command Event Subscriptions
fileListUpdated() // Used to add or remove tree items based on new file list and to identify which files need validation
featureValidated() // Used to update the file validation status

// Emitted Command Events
featureValidationRequested() // Used to identify which features are pending validation

// Query Event Subscriptions
getChildrenRequested()
getParentRequested()
getItemRequested()

// Published Success Events
ChildrenRetrieved()
ParentRetrieved()
ItemRetrieved()

// Published Error Events
FeatureExplorerServiceError(itemID, message)
  ChildrenRetrievalError
  ParentRetrievalError
  ItemRetrievalError

// Success Events
TreeUpdated() // emitted when the tree data has changed

// Error Events
ItemDoesNotExist

```

### File Parser

Reads feature files and produces unvalidated feature file data available events. In production, the Feature File Parser uses the Cucumber Gherkin Parser.

```TypeScript

// Command Event Subscriptions
ParseFeatureFileRequested(path)

// Query Event Subscriptions

// Published Success Events
FileParsed(unvalidatedFeature)

// Published Error Events
FileParsingError(path, message)
  FileDoesNotExist(path, message)
  NotAFile(path, message)
  NotGherkin(path, message)
  InvalidGherkin(path, message)

```

### Feature Validator

The feature validator is a stateless service that validates unvalidated features

```TypeScript

// Event Subscriptions
featureValidationRequested(unvalidatedFeature)

// Published Success Events
ValidationComplete(validatedFeature)

// Pupblished Error Events
ValidationError(type, message)

```

```TypeScript
// Internal types
type Tag = {
  
}

type Feature = {

}

type Scenario = {

}

type ScenarioOutline = {

}

type Rule = {

}

type Example = {

}

type ValidatedFeature = {
  
}

```

### Filtering Service

Filters files

```TypeScript

```

## Supporting Domain Bounded Contexts

### File Listing Service

Stateless service that provides a list of files and directories at a given path.

```TypeScript
// Commands
ListFiles(path)
ListFilesRecursive(path)

// Command Handlers

// Success Events
ListComplete : FileList

// Error Events
InvalidPathError

// Queries

// Query Handlers

// Types
interface FileListing = {

}
```

```TyepScript
type FSItemBase = {
  path: string;
  name: string;
  id: number;
  timestamp: number;
}

enum FSItemType = {
  File,
  Directory,
  Link
}

type Directory = FSItemBase & {
  const type : FSItemType = Directory;
}

type Link = FSItemBase & {
  const type : FSItemType = Link;
}

type File = FSItemBase & {
  const type : FSItemType = File;
}

type MillisecondsSinceEpoch = number;
type FileID = number;

type FSItem = {
  type: FSItemType;
  path: string;
  name: string;
  id: FileID;
  timestamp: MillisecondsSinceEpoch;
}

type FileList = Array<FSItem>

```

### File Watcher

Stateful service that watches files and directories for changes, publishing events whenever a watched file or directory changes.

### Tree View

The tree view acts as an anti-corruption layer between the application and VS Code.

### Event Bus

The Event Bus takes handles publishing and subscribing to events. It acts as an anti-corruption layer between the domain and the actual mechanism for event processing.

```TypeScript

EventTypeRegistry

class EventType {
  private topic: string
  private eventName: string
}

class Event {
  private eventType: EventType
  private sentTime: number
  private receivedTime: number
  private eventData: any
}

interface EventBus {
  registerEventType(eventType: EventType)
  subscribeToEventType(eventType: EventType)
  publishEvent(event: Event)
}

```

## Workflows

```TypeScript

// Activation workflow
  // Trigger: user enters a view with the Feature Explorer Tree
  ActivateFeatureExplorer()
  //Input
  rootDirectory: Directory
  //Dependencies
  WatchFeatureFiles(dir: Directory)
  ListFiles(dir: Directory) : Array<FSItem>
  ParseFeatureFiles(files: Array<File>) : Array<ParsedFile>
  ValidateFeatureFiles(files: Array<ParsedFile>)
  //Output
  FeatureExplorerActivated : Event
  //Workflow
  WatchFeatureFiles()
  FeatureFilesWatched()

  FindFeatureFiles()
  FeatureFilesFound()

  ParseFeatureFiles()
  FeatureFilesParsed()

  ValidateFeatureFiles()
  FeatureFilesValidated()

// Deactivation workflow
  // Trigger: user deactivates extension
  // Trigger: user closes VS Code
  StopWatchingFiles()
  WatcherStopped()
  TeardownTreeView()
  TreeViewTornDown()

// Display tree workflow
  // Trigger: user enters a view that displays the Feature Explorer tree
  DisplayFeatureTree()
  FeatureTreeDisplayed()

// File created workflow
  // Trigger: File created event
  ParseFeatureFile(file: File) : ParsedFile
  ValidateFeatureFile(file: ParsedFile) : ValidatedFile
  AddValidatedFile(file: ValidatedFile, ValidatedFileCollection)
  // Output
  ValidatedFileAdded : Event

// File updated workflow
  // Trigger: File updated event.
  ParseFeatureFile(file: File) : ParsedFile
  FeatureFileParsed()
  ValidateFeatureFile(file: ParsedFile) : ValidatedFile
  FeatureFileValidated()
  UpdateValidatedFile(file: ValidatedFile, ValidatedFileCollection)
  ValidatedFilelUpdated()

// File renamed workflow
  // Trigger: File renamed event.
  UpdateValidatedFile(file: ValidatedFile, ValidatedFileCollection)
  ValidatedFileUpdated()

// Root directory updated workflow
  // Trigger: User changes setting in extension configuration
  // Trigger: User right-clicks on directory and selects "set as feature root"

// Error-based filter applied
  // Trigger: User selects "Show only files with errors"
  // Trigger: User selects "Show only files without errors"
  // Future enhancement - filter by specific error types

// Warning-based filter applied
  // Trigger: User selects "Show only items with warnings"
  // Trigger: User selects "Show only item without warnings"
  // Future enhancment - filter by specific warning types
  ApplyFilters()
  FiltersApplied()
  UpdateTree()
  TreeUpdated()

// Tag-based filter applied
  // Trigger: User selects "Show only items with tags"
  // Trigger: User selects "Show only items without tags"
  // Trigger: User selects "Show only items with any of" and specifies tags
  // Trigger: User selects "Show only items without any of" and specifies tags
  // Trigger: User selects "Show only items with all of" and specifies tags
  // Trigger: User selects "Show only items without all of" and specifies tags
  ApplyFilters()
  FiltersApplied()
  UpdateTree()
  TreeUpdated()

// Error-based filter removed
  // Trigger: User clears "Show only files with errors"
  // Trigger: User clears "Show only files without errors"
  // Trigger: User selects "Clear all filters"
  ApplyFilters()
  FiltersApplied()
  UpdateTree()
  TreeUpdated()

// Warning-based filter removed
  // Trigger: User clears "Show only items with errors"
  // Trigger: User clears "Show only items without errors"
  // Trigger: User selects "Clear all filters"
  ApplyFilters()
  FiltersApplied()
  UpdateTree()
  TreeUpdated()

// Tag-based filter removed
  // Trigger: User clears "Show only items with warnings"
  // Trigger: User clears "Show only items without warnings"
  // Trigger: User selects "Clear all filters"
  ApplyFilters()
  FiltersApplied()
  UpdateTree()
  TreeUpdated()

// View and edit file workflow
// Trigger: User clicks on feature in explorer
// Trigger: User clicks on scenario in explorer
// Trigger: User clicks on scenario outline in explorer
// Trigger: User clics on rule in explorer
OpenFileWithFocusOnItem()
FileOpened()
```

## External systems

### Visual Studio Code

Visual Studio Code is a source code editor. It provides an API for extensions like Feature Explorer to be able to plug in additonal features and UI.

### Cucumber Gherking Parser

The developers of Cucumber provide a parser that can be called from Javascript. It reads in files and attempts to parse them into a data format called "Gherkin AST". If the file cannot be parsed it produces an error record.

### Node.js

Node.js is a set of Javascript libraries that provides access to the underlying system's filesystem through an event-driven programming model.
